要件定義（HEIC→JPG 変換Webアプリ）

1. 目的・概要
•目的：iPhoneで撮影した .HEIC 画像を品質を落とさず .jpg に一括変換し、ZIPでまとめてダウンロードできる、**サーバーレス（ブラウザ内処理）**のWebツールを提供する。
•想定ユーザー：個人利用者、写真をPC/スマホで扱う一般ユーザー。

2. 対応プラットフォーム
•実行場所：ブラウザ（クライアントサイド、WASM利用）
•デバイス：PC / スマホ（iPhone / Android）
•ブラウザ：最新の主要ブラウザ（Chrome / Safari / Edge / Firefox）
•注：古いSafari等でWebAssemblyやFile System APIに制限がある場合はフォールバック（通常のファイル選択）で動作。

3. 入出力仕様
•入力：拡張子 .heic / MIME image/heic のみ受け入れ
•複数選択可、最大200枚を目安（合計サイズの上限はブラウザメモリを考慮して後述）。
•ドラッグ＆ドロップ（D&D）を基本。スマホではファイル選択も可。
•出力（画像）：
•フォーマット：.jpg
•品質：劣化なし（可能な限り原画質に近いエンコード。品質係数はデフォルト高め：例 quality=0.95〜1.0）
•リサイズ：なし
•メタデータ：EXIF等は保持
•ファイル名：元ファイル名を踏襲し拡張子のみ.jpgに変更（例：IMG_1234.HEIC → IMG_1234.jpg）
•出力（アーカイブ）：
•まとめて ZIP 化
•ファイル名：converted_YYYY-MM-DD_HH-mm.zip（ユーザー端末のローカル時刻）

4. ユーザー体験（UX）
•フロー：
1.画面のD&Dエリアにファイル投入（またはタップで選択）
2.受け付け後に進捗バー表示（枚数・%）と注意文「変換中はこの画面を閉じないでください」
3.変換完了後に**「ダウンロード」ボタン**が有効化 → クリックでZIP保存
•進捗表示：
•「処理中 n/N」「全体%」を表示
•ステージ別メッセージ（読み込み→変換→ZIP化→準備完了）
•エラー方針：全体停止＋分かりやすいメッセージ
•HEIC以外混入：エラー表示（例：「HEIC以外のファイルが含まれています：xxx」）
•変換失敗：エラー表示（例：「IMG_1234.HEIC の変換に失敗しました」）
•どちらもZIP生成せず、やり直し導線（「再選択」ボタン）を提示
•操作：
•D&D領域：クリックでもファイルダイアログを開く
•「キャンセル」ボタン（処理中にAbortできるようにする／オプション）
•完了後は同セッションで再実行可能（状態リセット）

5. 非機能要件
•性能：
•目安：12MP級HEIC（~2–5MB/枚）を最大200枚処理
•逐次処理または小さな並列（例：同時2〜4枚）でメモリピークを抑制
•ZIPはストリーム/分割追加でメモリ圧迫を回避（可能なら）
•メモリ安全：
•画像は逐次ArrayBuffer→デコード→エンコード→ZIP追加→中間破棄
•同時並列は端末性能で調整（簡易的にユーザー設定/自動推定も可）
•セキュリティ & プライバシー：
•サーバー送信なし（完全ローカル）
•クリップボードや外部ストレージへ勝手にアクセスしない
•例外・エラー内容に画像内容を含めない
•アクセシビリティ：
•キーボード操作可、コントラスト配慮、ARIA属性（進捗バー）
•スマホの縦横レイアウト対応
•多言語：
•初期は日本語。テキストを定数化し将来のi18nに備える
•オフライン：
•任意：PWA対応（後工程）。オフラインで開けると便利
•法務：
•使用ライブラリ（heic2any, JSZip 等）のライセンス表記

6. 例外・制約
•一部ブラウザでHEICデコードに制約がある場合はWASM版デコーダを使用。
•端末メモリ不足やブラウザタブのメモリ制限で失敗する可能性があるため、失敗時の再試行とバッチサイズ/同時数の調整UIをオプション提供可。
•位置情報などEXIF保持が既定。必要に応じて「位置情報のみ削除」オプションを将来追加できる設計。

7. UI詳細（最小構成）
•ヘッダー：タイトル、簡単な説明文
•D&Dカード：アイコン、説明、対応拡張子、タップで選択
•ボタン群：
•「変換開始」（ファイル投入後に活性）
•「キャンセル」（処理中のみ表示/活性）
•「ダウンロード」（完了時活性）
•「再選択/やり直し」
•インジケータ：進捗バー、経過ステップ、残り枚数
•注意書き：「変換中はこの画面を閉じないでください」

8. 技術選定
•HEIC→JPG：heic2any（内部でlibheif/WASM系）または同等
•ZIP生成：JSZip（大きいZIPには生成時間がかかるため進捗イベントを表示）
•UI：素のHTML/CSS/JS（将来React化も容易な構成）
•ワーカー：Web Workerで変換処理をオフロード（UIブロック回避）
•型/品質：任意でTypeScript導入、ESLint/Prettier

9. ログ・計測（任意）
•ブラウザ内のみの匿名統計（送信しない）
•失敗理由・ブラウザ種別・平均処理時間などをコンソールに出すデバッグモード

10. 受け入れ基準（抜粋）
•HEICのみ投入時、200枚まで問題なく変換できる（テストデータで検証）
•元名→拡張子だけ.jpgへ確実に変換
•EXIF保持を確認（撮影日時・カメラ情報等）
•ZIP名が converted_YYYY-MM-DD_HH-mm.zip となる
•進捗バーが実際の進捗と概ね一致
•エラー混入時に処理を中断し、理由が表示される
•PC/スマホ主要ブラウザでUIが崩れない
